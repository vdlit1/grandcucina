<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     enterprise_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
?>
<?php
/**
 * Category view template
 *
 * @see Mage_Catalog_Block_Category_View
 */
?>
<?php
    $_helper    = $this->helper('catalog/output');
    $_category  = $this->getCurrentCategory();
    $_imgHtml   = '';
    if ($_imgUrl = $_category->getImageUrl()) {
        $_imgHtml = '<p class="category-image"><img src="'.$_imgUrl.'" alt="'.$this->htmlEscape($_category->getName()).'" title="'.$this->htmlEscape($_category->getName()).'" /></p>';
        $_imgHtml = $_helper->categoryAttribute($_category, $_imgHtml, 'image');
    }
?>
<?php echo $this->getMessagesBlock()->toHtml() ?>
<div class="category-view">
    <?php if($_imgUrl): ?>
        <?php echo $_imgHtml ?>
    <?php endif; ?>
    <?php  $collectionSlider = Mage::getBlockSingleton('tagimage/tagimage')->getCollection(); ?>
    <?php $category = Mage::registry('current_category')->getId(); ?>
    <?php 
    $count = 0; 
    if (count($collectionSlider) > 0){
        foreach ($collectionSlider as $_item) : $i++ ;
             $filter = explode(',',$_item->getCategories());
             if(in_array($category, $filter)):
                 $count++;
             endif;
        endforeach;
    }
    ?>
   
            <?php if ($count > 0) : ?>
           
            <div class="list-sub-category">
                    <div id="myshow1" class="slider-container">
                        <ul class="category-slider show">
                            <?php $i =0;  ?>
                            <?php foreach ($collectionSlider as $_item) : $i++ ?>
                            <?php  $filter = explode(',',$_item->getCategories()); ?>
                            <?php if(in_array($category, $filter)):?>
                                <li class="slide" data-slide-interval="">
                                    <div class="jTagOverlay">
                                        <?php echo Mage::getBlockSingleton('tagimage/tagimage')->getOverlayHtml($_item['tagimage_id']); ?>
                                    </div>
                                    <img  width="719" height="391" alt="" src="<?php echo $this->helper('tagimage/image')->init($_item->getFile())->keepFrame(true)->resize(719,391); ?>" />
                                    <div class="data-container">
                                        <?php echo $_item->getImagecontent(); ?>
                                    </div>
                                </li>
                                <?php endif; ?>
                            <?php endforeach; ?>
                        </ul>
                        <ol class="proto-controls"><li class="proto-control start-stop"><a title="Pause the show" href="javascript:void(0)"></a></li><li class="proto-control backward"><a title="Go to Previous slide and play backwards" href="javascript:void(0)"></a></li><li class="proto-control forward"><a title="Go to Next slide and play forwards" href="javascript:void(0)"></a></li></ol>
                    </div>
            </div>  
<?php if ($count > 1) : ?>			
            <script>
            var myshow;

            Event.observe(window, "load", function() {

            $('myshow1') && $('myshow1').protoShow({
                    interval	:	4000,
                    captions	: 	false
            });

            $$('.proto-navigation li a').each(function(element){
                    //$(element).update('s');
                    $$('.protoshow ul.show li.slide').each(function(e){
                        var lang = 'tab_'+(e.readAttribute('lang'));
                        if(element.id ==lang){
                        $(element).update(e.readAttribute('title'));
                        }
                    })
                });
            });
            </script>
<?php endif ?>
            <script type="text/javascript">
                function showTag(id){
                    var box_height = $('table_'+id).getHeight();
                    var box_width = $('table_'+id).getWidth();
                    var slide_height = 440;
                    var slide_width   = 810;
                    var top = $(id).getStyle('top').replace('px', '');
                    var left =  $(id).getStyle('left').replace('px', '');
                    if(parseInt(slide_height)<(parseInt(box_height)+parseInt(top))){
                        var _top_ = (parseInt(top)-parseInt(box_height));
                        if(_top_<0){
                            _top_ = 0;
                        }
                        $(id).setStyle({'top':_top_+'px'});
                    }
                    if(parseInt(slide_width)< (parseInt(box_width)+parseInt(left))){
                        var _left_ = (parseInt(left)-parseInt(box_width))-20;
                            $(id).setStyle({'left':_left_+'px'});
                    }

                    $('table_'+id).show();
                    $$('table.table_'+id).each(function(e){
                        e.show();
                    });
                    $(id).setOpacity(0.9999);

                };
                function hideTag(id){
                    $('table_'+id).hide();
                    $$('table.table_'+id).each(function(e){
                        e.hide();
                    });
                    $(id).setOpacity(0.001);

                };
            </script>
        <?php endif ?>   
            
            
            
            
	<?php echo $this->getChildHtml('category.sub') ?>
	<?php echo $this->getProductListHtml() ?>
</div>
